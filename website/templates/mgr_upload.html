{% load static %}
<!DOCTYPE>
<html>
<head>
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
	<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
	<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
    <script src="{% static 'js/ui.js' %}"></script>
	<script src="{% static 'js/cms.js' %}"></script>
    <script type="text/javascript">
        $(window).resize(function () { 
            closeNav();
        });

        function modiMac(mac) {
            document.getElementById('modify_mac').innerHTML = mac;
            $('form[name="modDevForm"] input[name="modify_mac"]').val(mac);
        }

        function remvMac(mac) {
            document.getElementById('remove_mac').innerHTML = mac;
            $('form[name="confirmRemv"] input[name="modify_mac"]').val(mac);
        }
        
        function upload() {
            $("#file-upload").click();
        }
            
		$(document).ready(function() {
            $("input[type=file]").click(function() {
                $(this).val("");
            });
            
            $("input[type=file]").change(function(e) {
                //console.log(e.target.files);
                $('form[name="addFile"]').submit();
            });
		});
        
        function fileUploadNew() {
            const realInput = document.getElementById('fileupload');
            realInput.click();
        //	realInput.addEventListener('change', () => {
                

        //	document.getElementById("upload_new_file").submit()
        //  });
            realInput.addEventListener('change', () => {
                const name = realInput.value.split(/\\|\//).pop();
                const truncated = name.length > 20  ? name.substr(name.length - 20)  : name;
                
                fileInfo.innerHTML = truncated;
            });
        }
        
        function modify(name) {
            $('#modify_name').val(name);
            $('#file_name').val(name.substring(0, name.lastIndexOf(".")));
            $('#file_ext').text(name.substring(name.lastIndexOf(".")));
            //$('#modFilename').modal('toggle');
        }
                
        function remove(name) {
            $('#remove_name').text(name);
            $('#remove_file').val(name);
            //$('#remvFile').modal('toggle');
        }
    </script>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=window.innerWidth, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Sinage</title>
</head>
<body class="body">
    <div class="wrapper">
        <div class="row">
            <div class="topnav">
                <button type="button" class="topnav-btn" id="topnav_btn_open_menu" onclick="openNav()"> 
                    <a class="nav-link active" href="#">
                        <svg class="col topnav-btn-icon">
                            <image xlink:href="{% static 'img/btn-menu-40.svg' %}" src="{% static 'img/btn-menu-40.png' %}" width="40" height="40"/>
                        </svg>
                    </a>
                </button> 
                <button type="button" class="topnav-btn topnav-btn-right" id="topnav_search" onclick="topNavSearchbarOpen();"> 
                    <a class="nav-link active" href="#">
                        <svg class="col topnav-btn-icon">
                            <image xlink:href="{% static 'img/btn-search-w.svg' %}" src="{% static 'img/btn-search-w.png' %}" width="40" height="40"/>
                        </svg>
                    </a>
                </button>
                <button type="button" class="topnav-btn  topnav-btn-right topnav-btn-close" id="topnav_btn_search_close" onclick="topNavSearchbarClose()">
                    <a class="nav-link" href="#">
                        <svg class="col topnav-btn-icon">
                            <image xlink:href="{% static 'img/btn-menu-close-40.svg' %}" src="{% static 'img/btn-menu-close-40.png' %}" width="40" height="40"/>
                        </svg>
                    </a>
                </button>   
                <div class="topnav-search-bar-container" id="topnav_search_bar_container">
                    <div class="topnav-search-input-container" id="topnav_search_input_container" onclick="">
                        <svg class="topnav-btn-right" width="26" height="26">
                        <image xlink:href="{% static 'img/ic-search.svg' %}" src="{% static 'img/ic-search.png' %}" width="26" height="26"/>
                        </svg>
                    </div>
                </div>
            </div>
            <button type="button" class="topnav-btn topnav-btn-close topnav-btn-close-menu" id="topnav_btn_close_menu" onclick="closeNav()">
                <a class="nav-link" href="#">
                    <svg class="col topnav-btn-icon">
                        <image xlink:href="{% static 'img/btn-menu-close-40.svg' %}" src="{% static 'img/btn-menu-close-40.png' %}" width="40" height="40"/>
                    </svg>
                </a>
            </button>              
            <div class="sidenav col" id="menu">
                <svg class="col sidenav-device-image" height="62" width="62">
                    <image xlink:href="{% static 'img/device-image.svg' %}" src="{% static 'img/device-image.png' %}" width="62" height="62"/>
                </svg>
                <p class="p-12">{{ name }}</p>
                <p class="p-10">{{ organization }}</p>
                <hr class="line" />
                <nav>
                    <a class="nav-link" href="/device_add/">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="30px" height="30px" viewBox="0 0 30 30" enable-background="new 0 0 30 30" xml:space="preserve">
                            <g>
                                <path id="icon_device_1" class="icon-color icon-color-b" d="M19.21,6.82h-8.43c-1.1,0-2,0.9-2,2v12.36c0,1.1,0.9,2,2,2h8.43c1.1,0,2-0.9,2-2V8.82
                                    C21.21,7.72,20.32,6.82,19.21,6.82z M20.21,21.18c0,0.55-0.45,1-1,1h-8.43c-0.55,0-1-0.45-1-1V8.82c0-0.55,0.45-1,1-1h8.43
                                    c0.55,0,1,0.45,1,1V21.18z"/>
                                <path id="icon_device_2" class="icon-color icon-color-b" d="M18.25,8.78h-6.5c-0.55,0-1,0.45-1,1v9.78c0,0.55,0.45,1,1,1h6.5c0.55,0,1-0.45,1-1V9.78
                                    C19.25,9.23,18.8,8.78,18.25,8.78z M11.75,9.78l0-0.5L11.75,9.78L11.75,9.78z M18.25,19.56h-6.5l0-9.78h6.5V19.56z"/>
                            </g>
                        </svg>
                        <span>裝置</span></a>
					<a id="upload_menu" class="nav-link active" href="/mgr_upload/">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="30px" height="30px" viewBox="0 0 30 30" enable-background="new 0 0 30 30" xml:space="preserve">
                            <g>
                                <path id="icon_file" class="icon-color" d="M20.82,21H9.18c-0.93,0-1.69-0.79-1.69-1.76v-8.67C7.5,9.71,8.18,9,9.02,9h5.58c0.45,0,0.86,0.28,1.03,0.71
                                    l0.39,0.96h4.81c0.93,0,1.69,0.79,1.69,1.76v6.81C22.5,20.21,21.75,21,20.82,21z M9.02,10c-0.29,0-0.52,0.26-0.52,0.58v8.67
                                    C8.5,19.66,8.8,20,9.18,20h11.63c0.38,0,0.69-0.34,0.69-0.76v-6.81c0-0.42-0.31-0.76-0.69-0.76h-5.48l-0.64-1.59
                                    c-0.02-0.05-0.06-0.08-0.1-0.08H9.02z"/>
                            </g>
                        </svg>
                        <span class="nav-txt">檔案</span></a>
                </nav>
                <hr class="line" />
                <a class="nav-logout" href="/logout">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="30px" height="30px" viewBox="0 0 30 30" enable-background="new 0 0 30 30" xml:space="preserve">
                            <g>
                                <path class="icon-color" d="M9.82,15.58h6.89c0.28,0,0.5-0.22,0.5-0.5s-0.22-0.5-0.5-0.5H9.82l1.46-1.46c0.2-0.2,0.2-0.51,0-0.71
                                    s-0.51-0.2-0.71,0L7.9,15.08l2.67,2.67c0.1,0.1,0.23,0.15,0.35,0.15s0.26-0.05,0.35-0.15c0.2-0.2,0.2-0.51,0-0.71L9.82,15.58z"/>
                                <path class="icon-color" d="M13.06,7.92v4.09c0,0.28,0.22,0.5,0.5,0.5s0.5-0.22,0.5-0.5V8.92h6.83v12.15h-6.83v-3.09
                                    c0-0.28-0.22-0.5-0.5-0.5s-0.5,0.22-0.5,0.5v4.09h8.83V7.92H13.06z"/>
                            </g>
                        </svg>
                    <span>登出</span></a>
            </div>
            <div class="main">
                <div class="container">
                    <div class="actionbar">
                        <form enctype="multipart/form-data" id='fileUpload' name="addFile" method="post" action="." class="upload-area">
                            {% csrf_token %}
                            <input type="text" class="d-none" placeholder="" value="addFile" name="func">
                            <div class="btn btn-add" onclick="fileUploadNew();">
                                <svg class="col btn-add-icon" width="32" height="32">
                                <image xlink:href="{% static 'img/ic-addfile.svg' %}" src="{% static 'img/ic-addfile.png' %}" width="32" height="32"/>
                                </svg>
                                <span>新增檔案</span>
                            </div>

                            <input id="fileupload" name="file" type="file" class="file-none d-none" multiple="multiple" required="required" onchange="loadingStart();this.form.submit();" accept=".json, .bin, .jpeg, .jpg, .png, .bmp, .raw"/>

                        </form>
                        <div id="search_area" class="search-container">          
                            <div class="search-input-container" id="search" onclick="searchBarOpen()">
                                <svg width="26" height="26">
                                <image xlink:href="{% static 'img/ic-search.svg' %}" src="{% static 'img/ic-search.png' %}" width="26" height="26"/>
                                </svg>
                            </div>
                            <div class="search-close" id="search_close" onclick="searchBarClose()">
                                <svg width="26" height="26">
                                <image xlink:href="{% static 'img/search-close.svg' %}" src="{% static 'img/search-close.png' %}" width="26" height="26"/>
                                </svg>
                            </div>
                            <input type="text" id="search_input" class="search-input-none search-input">
                        </div>
                    </div>
                    <div class="tableview">
                        <div class="thead">
                            <div class="tr row" id="uploadtable">
                                <div class="th col-lg-6 tablesorter tablesorter-header">名稱</div>
                                <div class="th col-lg-3">路徑</div>
                                <div class="th col-lg-3"></div>
                            </div>
                        </div>
                        <div class="tbody tbody-short" id="uploadtable_tbody">
                            {% for file in files %}
                            <div class="tr row table-row myfile" id="file{{ file.extension }}">
                                <div class="td col-lg-6" data-title="名稱">{{ file }}</div>
                                <div class="td col-lg-3" data-title="路徑">
                                    <button class="btn-copy" onclick="copyStringToClipboard('media/Manager/{{ file }}');">
                                        <svg width="40" height="40">
                                            <image xlink:href="{% static 'img/ic-copy.svg' %}" src="{% static 'img/ic-copy.png' %}" width="40" height="40"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="td col-lg-3" data-title="">
                                    <div class="btn-group">
                                        <button class="btn-action" data-toggle='modal' data-target='#modFilename' data-rel="dialog" onclick="modify('{{ file }}')">
                                            <svg width="40" height="40" class="align-top">
                                                <image xlink:href="{% static 'img/btn-edit.svg' %}" src="{% static 'img/btn-edit.png' %}" width="40" height="40"/>
                                            </svg>
                                        </button>
                                        <button class="btn-action" data-toggle='modal' data-target='#remvFile' onclick="remove('{{ file }}')">
                                            <svg width="40" height="40" class="align-top">
                                                <image xlink:href="{% static 'img/btn-delete.svg' %}" src="{% static 'img/btn-delete.png' %}" width="40" height="40"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                <form enctype='multipart/form-data' name='modFilenameForm' action='.' method='POST'>
                    {% csrf_token %}
                    <div class='modal fade' id='modFilename' tabindex='-2' role='dialog' aria-labelledby='exampleModalLabel' aria-hidden='true'>
                        <div class='modal-dialog' role='document' id='device_config'>
                            <div class='modal-content'>
                                <div id='mac_id' class='dialog-header'>
                                    <h4 id='modify_dev' class='modal-title dialog-title' id='exampleModalLabel'>重新命名
                                    </h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class='dialog-body'>
                                    <input type="text" class="d-none" placeholder="" value="modifyFile" name="func">
                                    <input type='hidden' id='modify_name' type='text' name='file'>
                                    
                                    <div>
                                        <input id='file_name' class="input-style dialog-input-style" type='text' name='file_name'>
                                        <span id='file_ext'></span>
                                    </div>
                                    

                                </div>
                                <div class='dialog-footer'>
                                    <button type='button' class='btn btn-secondary' data-dismiss='modal' >取消</button>
                                    <button type='submit' class='btn btn-dark btn-90'>完成</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <form enctype='multipart/form-data' name='remvFileForm' action='.' method='POST'>
                    {% csrf_token %}
                    <div class='modal fade' id='remvFile' tabindex='-2' role='dialog' aria-labelledby='exampleModalLabel' aria-hidden='true'>
                        <div class='modal-dialog' role='document' id='device_remove'>
                            <div class='modal-content'>
                                <div class='dialog-header'>
                                    <h4 id='remove_name' class='modal-title' id='exampleModalLabel'></h4>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class='dialog-body'>確定要刪除此檔案？ </div>
                                <input type="text" class="d-none" placeholder="" value="deleteFile" name="func">
                                <input type='hidden' name='file' id='remove_file'>
                                <div class='dialog-footer'>
                                    <button type='button' class='btn btn-secondary' data-dismiss='modal' >取消</button>
                                    <button type='submit' class='btn btn-red btn-90'>刪除</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

        <!-- message -->
        <div class="modal fade" id="messageModal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-body m-1">
                        {% for message in messages %}
                        <div class='alert alert-{{message.tags}} fade show'>{{message}}</div>
                        {% endfor %}
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button type="button" class="btn btn-primary btn-dark" data-dismiss="modal">確認</button>
                    </div>
                </div>
            </div>
        </div>

</body>
</html>
